const CoinbasePro = require('coinbase-pro');
const { KEY, SECRET, PASSPHRASE, URL } = require('../config.json');
const createCsvWriter = require('csv-writer').createObjectCsvWriter;

const getAllEntries = async (req, res) => {
    // const publicClient = new CoinbasePro.PublicClient();

    await new CoinbasePro.AuthenticatedClient(
        KEY,
        SECRET,
        PASSPHRASE,
        URL
    ).getFills({ product_id: 'BTC-USD' })
        .then(data => {

            createCsvWriter({
                path: 'out.csv',
                header: [
                    {
                        id: 'CreatedAt',
                        title: 'created_at'
                    },
                    {
                        id: 'trade_id',
                        title: 'trade_id'
                    },
                    {
                        id: 'product_id:',
                        title: 'product_id:'
                    },
                    {
                        id: 'order_id',
                        title: 'order_id'
                    },
                    {
                        id: 'user_id',
                        title: 'user_id'
                    },
                    {
                        id: 'profile_id',
                        title: 'profile_id'
                    },
                    {
                        id: 'liquidity',
                        title: 'liquidity'
                    },
                    {
                        id: 'price',
                        title: 'price'
                    },
                    {
                        id: 'size',
                        title: 'size'
                    },
                    {
                        id: 'fee',
                        title: 'fee'
                    },
                    {
                        id: 'side',
                        title: 'side'
                    },
                    {
                        id: 'settled',
                        title: 'settled'
                    },
                    {
                        id: 'usd_volume',
                        title: 'usd_volume'
                    },
                ]
            }).writeRecords(data);
            res.jsonp({ data });
        })
        .catch(error => console.log('error', error));
};

module.exports = getAllEntries;