const CoinbasePro = require('coinbase-pro');
const { KEY, SECRET, PASSPHRASE, URL, HEADER } = require('../config.json');
const createCsvWriter = require('csv-writer').createObjectCsvWriter;

const getAllEntries = async (req, res) => {
    await new CoinbasePro.AuthenticatedClient(
        KEY,
        SECRET,
        PASSPHRASE,
        URL
    ).getFills({ product_id: 'BTC-USD' })
        .then(data => {
            createCsvWriter({
                path: 'out.csv',
                header: HEADER
            }).writeRecords(data);
            res.jsonp({ data });
        })
        .catch(error => console.log('error', error));
};

module.exports = getAllEntries;